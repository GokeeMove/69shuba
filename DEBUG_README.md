# 小说爬虫调试功能说明

## 概述
为小说爬虫程序添加了完整的调试功能，包括日志记录、性能监控、错误追踪等。

## 主要功能

### 1. 日志系统
- **多级别日志**: DEBUG, INFO, WARNING, ERROR, CRITICAL
- **双重输出**: 同时输出到控制台和日志文件
- **时间戳**: 每条日志都包含精确的时间戳
- **自动文件命名**: 日志文件按时间自动命名

### 2. 性能监控
- **请求统计**: 记录总请求数、成功数、失败数
- **时间统计**: 记录请求时间、解析时间、总耗时
- **成功率计算**: 自动计算请求成功率
- **平均时间**: 计算平均请求和解析时间

### 3. 错误处理
- **异常捕获**: 全面捕获各种异常
- **详细错误信息**: 包含完整的错误堆栈跟踪
- **错误分类**: 区分网络错误、解析错误等
- **失败重试**: 支持自动重试机制

### 4. 调试模式
- **开关控制**: 通过 `DEBUG_MODE` 变量控制
- **详细输出**: 调试模式下显示更多详细信息
- **进度显示**: 实时显示处理进度

## 使用方法

### 基本使用
```python
# 运行程序，调试功能自动启用
python WxListd2.py
```

### 配置调试选项
```python
# 在代码开头修改这些变量
DEBUG_MODE = True  # 开启/关闭调试模式
LOG_LEVEL = logging.DEBUG  # 设置日志级别
```

### 查看日志文件
程序运行后会在当前目录生成日志文件：
- 文件名格式: `crawler_debug_YYYYMMDD_HHMMSS.log`
- 包含完整的运行日志和错误信息

## 调试信息说明

### 日志级别
- **DEBUG**: 详细的调试信息，包括请求URL、响应长度等
- **INFO**: 一般信息，如程序启动、章节完成等
- **WARNING**: 警告信息，如页面结构变化等
- **ERROR**: 错误信息，如请求失败、解析失败等

### 性能统计
程序运行完成后会显示：
```
==================================================
性能统计报告:
总耗时: 45.123秒
请求总数: 150
成功数: 148
失败数: 2
成功率: 98.67%
平均请求时间: 0.234秒
平均解析时间: 0.045秒
==================================================
```

### 错误处理
- 网络错误：自动重试，记录失败原因
- 解析错误：跳过错误章节，继续处理其他章节
- 文件错误：检查文件权限，提供详细错误信息

## 故障排除

### 常见问题
1. **导入错误**: 确保安装了所有依赖包
   ```bash
   pip install lxml requests aiohttp
   ```

2. **网络超时**: 调整网络配置中的超时时间
   ```python
   NETWORK_CONFIG['request_timeout'] = 60  # 增加超时时间
   ```

3. **内存不足**: 减少并发数
   ```python
   sem = asyncio.Semaphore(20)  # 减少并发数
   ```

### 调试技巧
1. **查看详细日志**: 设置 `LOG_LEVEL = logging.DEBUG`
2. **分析性能瓶颈**: 查看性能统计报告
3. **定位错误**: 查看日志文件中的错误堆栈
4. **监控进度**: 观察控制台输出的进度信息

## 配置文件
使用 `debug_config.py` 可以更灵活地配置调试选项：
```python
from debug_config import get_debug_config, print_config

config = get_debug_config()
print_config()  # 显示当前配置
```

## 注意事项
1. 调试模式会增加程序运行时间和内存使用
2. 日志文件会占用磁盘空间，建议定期清理
3. 在生产环境中建议关闭调试模式以提高性能
4. 敏感信息（如Cookie）不会记录到日志中
